function hideIOSKeyboard(){document.activeElement.blur(),$("input").blur()}function SubwayStation(a){var b=this;b.name=a.name,b.line=a.line,b.division=a.division,b.routes=a.routes,b.latitude=parseFloat(a.latitude),b.longitude=parseFloat(a.longitude),b.flickrContent=null,b.mapMarker=new google.maps.Marker({position:{lat:b.latitude,lng:b.longitude},map:map,title:b.name}),b.infoWindow=new google.maps.InfoWindow,b.showInfoWindow=function(){if(!b.infoWindow.getContent()){b.infoWindow.setContent("Loading content...");var a='<h3 class="info-title">'+b.name+"</h3>";a+='<small class="info-subtitle">'+b.line+" / "+b.division+"</small>",a+='<p class="info-route-list">Routes: ',a+='<span class="info-routes">'+b.routes.join()+"</span></p>",b.infoWindow.setContent(a)}b.flickrContent||flickr.getPhotos(b.latitude,b.longitude,function(a){var c='<div class="flickr-box">';c+='<h3 class="flickr-headline">Flickr Photos</h3>',a.forEach(function(a){c+='<a class="flickr-thumb" href="'+a.photoPage+'" target="_blank"><img src="'+a.imgThumbUrl+'"></a>'}),c+="</div>",b.flickrContent=c;var d=b.infoWindow.getContent()+c;b.infoWindow.setContent(d)}),b.infoWindow.open(map,b.mapMarker)},b.activate=function(){SubwayStation.prototype.active&&SubwayStation.prototype.active!==b&&SubwayStation.prototype.active.deactivate(),b.mapMarker.setAnimation(google.maps.Animation.BOUNCE),b.showInfoWindow(),SubwayStation.prototype.active=b},b.deactivate=function(){b.mapMarker.setAnimation(null),b.infoWindow.close(),SubwayStation.prototype.active=null},b.focus=function(){map.panTo({lat:b.latitude,lng:b.longitude}),b.activate()},b.mapMarkerClickHandler=function(){SubwayStation.prototype.active===b?b.deactivate():b.activate(),hideIOSKeyboard()},b.infoWindowCloseClickHandler=function(){b.deactivate()},b.mapMarker.addListener("click",b.mapMarkerClickHandler),b.infoWindow.addListener("closeclick",b.infoWindowCloseClickHandler)}function ListViewModel(){var a=this;a.stations=ko.observableArray([]),a.filter=ko.observable(""),a.loadingMsg=ko.observable("Loading subway stations..."),a.isVisible=ko.observable(!0),a.filterResults=ko.computed(function(){var b=[],c=new RegExp(a.filter(),"i");return a.stations().forEach(function(a){-1!==a.name.search(c)?(b.push(a),a.mapMarker.setVisible(!0)):(a.mapMarker.setVisible(!1),SubwayStation.prototype.active===a&&a.deactivate())}),b}),a.toggleVisibility=function(){a.isVisible(!a.isVisible())},a.clickHandler=function(b){window.innerWidth<1024&&a.isVisible(!1),b.focus()};var b="https://www.richgieg.com/nyc-subway-api/stations";$.getJSON(b,function(b){var c,d=[],e=new google.maps.LatLngBounds;b.stations.forEach(function(a){c=new SubwayStation(a),d.push(c),e.extend(c.mapMarker.position)}),a.stations(d),map.fitBounds(e),a.loadingMsg(null)}).fail(function(){a.loadingMsg("Unable to load data... try refreshing"),console.log("ERROR: Could not acquire subway station data")})}function initMap(){map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.718092,lng:-73.901454},disableDefaultUI:!0}),map.addListener("click",function(){hideIOSKeyboard()}),ko.applyBindings(new ListViewModel)}function initMapLoadError(){alert("Failed to initialize the Google Maps API"),console.log("Failed to initialize Google Maps API")}SubwayStation.prototype.active=null;var map;